<div
  class="content"
  [attr.aria-disabled]="disabled || null"
  (dragover)="onDragOver($event)"
  (dragleave)="onDragLeave($event)"
  (drop)="onDrop($event)"
>
  <!-- single top row that stacks your projected topTpl AND the attachments -->
  <div class="top-row">
    <div class="top" *ngIf="topTpl">
      <ng-container
        [ngTemplateOutlet]="topTpl"
        [ngTemplateOutletContext]="{ value: value }"
      >
      </ng-container>
    </div>

    <!-- Moved here: attachment well now lives in TOP row -->
    <div
      class="attachment-well"
      *ngIf="allowAttachments && attachments?.length"
      role="list"
    >
      <maxterdev-attachment-chip
        *ngFor="let a of attachments; trackBy: trackById"
        [attachment]="a"
        (remove)="onRemove($event)"
      >
      </maxterdev-attachment-chip>
    </div>
  </div>

  <div class="left" *ngIf="leftTpl">
    <ng-container
      [ngTemplateOutlet]="leftTpl"
      [ngTemplateOutletContext]="{ value: value }"
    >
    </ng-container>
  </div>

  <ng-container *ngIf="multiline; else singleline">
    <textarea
      #textareaEl
      [attr.id]="id ?? null"
      [attr.name]="name"
      [attr.placeholder]="placeholder"
      [readonly]="readonly"
      [required]="required"
      [disabled]="disabled"
      [attr.aria-invalid]="required ? (value.length ? null : true) : null"
      [attr.aria-describedby]="describedBy"
      rows="1"
      autosize
      [autosizeDisabled]="autosizeDisabled"
      #autosizeDir="autosize"
      [maxRows]="maxRows"
      [ngModel]="value"
      (ngModelChange)="value = $event"
      (blur)="handleBlur()"
      (paste)="onPaste($event)"
      [style.height]="autosizeDisabled ? 'unset' : null"
      [style.overflow-y]="autosizeDisabled ? 'auto' : null"
    >
    </textarea>
  </ng-container>

  <ng-template #singleline>
    <input
      #inputEl
      [attr.id]="id ?? null"
      [attr.name]="name"
      [attr.type]="type || 'text'"
      [attr.placeholder]="placeholder"
      [readonly]="readonly"
      [required]="required"
      [disabled]="disabled"
      [attr.autocomplete]="autocomplete ?? null"
      [attr.inputmode]="inputMode ?? null"
      [attr.enterkeyhint]="enterKeyHint ?? null"
      [attr.maxlength]="maxlength ?? null"
      [attr.minlength]="minlength ?? null"
      [attr.pattern]="pattern ?? null"
      [attr.aria-describedby]="describedBy ?? null"
      [ngModel]="value"
      (ngModelChange)="value = $event"
      (paste)="onPaste($event)"
    />
  </ng-template>

  <div class="right" *ngIf="rightTpl">
    <ng-container
      [ngTemplateOutlet]="rightTpl"
      [ngTemplateOutletContext]="{ value: value }"
    >
    </ng-container>
  </div>

  <div class="bottom" *ngIf="bottomTpl">
    <ng-container
      [ngTemplateOutlet]="bottomTpl"
      [ngTemplateOutletContext]="{ value: value }"
    >
    </ng-container>
  </div>

  <input
    #fileInput
    type="file"
    [attr.accept]="accept || null"
    [attr.multiple]="multiple ? '' : null"
    (change)="onNativeFiles($event)"
    hidden
  />
</div>

<div class="drop-overlay" *ngIf="isDragOver && allowAttachments">
  Drop files to attach
</div>
<div class="input-line"></div>
